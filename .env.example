# ============================================
# DATABASE (optional - metrics storage)
# ============================================
# If not set, DB storage is skipped (alerting works fine without it)
# DATABASE_URL=postgresql://user:password@localhost:5432/metrics_store

# ============================================
# API (automatic - REST endpoints)
# ============================================
# API is enabled when DATABASE_URL is set
# 100 API keys are auto-generated in the api_keys table on first run
# Retrieve keys via: GET /api/keys (requires any valid key to access)

# ============================================
# NOTIFICATION CHANNELS
# ============================================

# Pushover (mobile push notifications)
PUSHOVER_ENABLED=true
PUSHOVER_USER_KEY=your_user_key_here
PUSHOVER_API_TOKEN=your_api_token_here

# Slack
SLACK_ENABLED=false
SLACK_BOT_TOKEN=xoxb-your-bot-token-here
SLACK_CHANNELS=#canton-alerts,#trading-desk
SLACK_USERS=U01ABC123,U04XYZ789

# ============================================
# ALERT SCHEDULES
# ============================================

# Alert 1: Threshold alerts (when Est.Traffic > Gross)
ALERT1_ENABLED=true
ALERT1_INTERVAL_MINUTES=15

# Alert 2: Status reports (all current values)
ALERT2_ENABLED=true
ALERT2_INTERVAL_MINUTES=60

# ============================================
# EXCLUSIONS (per-alert filtering)
# ============================================
# Targets in these lists will NOT receive that alert type
# Everyone else gets everything by default

# Alert 1 exclusions (threshold alerts)
ALERT1_EXCLUDE_PUSHOVER=false
ALERT1_EXCLUDE_CHANNELS=
ALERT1_EXCLUDE_USERS=

# Alert 2 exclusions (status reports)
ALERT2_EXCLUDE_PUSHOVER=false
ALERT2_EXCLUDE_CHANNELS=
ALERT2_EXCLUDE_USERS=

# ============================================
# CHANGE ALERTS (Alerts 3, 4, 5)
# ============================================
# These alerts detect percentage changes vs 1hr or 24hr averages
# COMPARISON_PERIOD options: 1hr, 24hr, both (or all)

# State-change mode: only fire alerts on state transitions (default: true)
# When enabled, you get 1 alert when threshold breached, 1 when recovered
# Set to false to get alerts every check while condition is met
STATE_CHANGE_MODE=true

# Shared interval for all change alerts
CHANGE_ALERTS_INTERVAL_MINUTES=15

# Alert 3: Est.Traffic spike/drop
ALERT3_ENABLED=true
ALERT3_THRESHOLD_PERCENT=30
ALERT3_COMPARISON_PERIOD=1hr

# Alert 3 exclusions
ALERT3_EXCLUDE_PUSHOVER=false
ALERT3_EXCLUDE_CHANNELS=
ALERT3_EXCLUDE_USERS=

# Alert 4: Gross spike/drop
ALERT4_ENABLED=true
ALERT4_THRESHOLD_PERCENT=30
ALERT4_COMPARISON_PERIOD=1hr

# Alert 4 exclusions
ALERT4_EXCLUDE_PUSHOVER=false
ALERT4_EXCLUDE_CHANNELS=
ALERT4_EXCLUDE_USERS=

# Alert 5: Diff (Gross - Est.Traffic) change
ALERT5_ENABLED=true
ALERT5_THRESHOLD_PERCENT=30
ALERT5_COMPARISON_PERIOD=1hr

# Alert 5 exclusions
ALERT5_EXCLUDE_PUSHOVER=false
ALERT5_EXCLUDE_CHANNELS=
ALERT5_EXCLUDE_USERS=

# ============================================
# ALERT 6: FAAM Concentration Monitor
# ============================================
# Monitors Canton Network provider concentration via FAAMView API
# Supports MULTIPLE INSTANCES with MULTIPLE RULES per instance
#
# Example Use Cases:
#   Instance 1: Personal monitoring (Top 2 > 50%, Top 3 > 60%) → Phone
#   Instance 2: Trading desk (Top 5 > 75%, Top 10 > 90%) → Slack #trading
#   Instance 3: Executive alert (Top 2 > 50% only) → Slack #executives

# Shared API configuration (used by all instances)
ALERT6_FAAMVIEW_API_KEY=faam_test_key_abc123def456ghi789jkl012mno345
ALERT6_FAAMVIEW_API_URL=https://faamview-backend-production.up.railway.app

# ============================================
# Instance 1: Personal Monitor
# ============================================
ALERT6_1_ENABLED=true
ALERT6_1_NAME=Personal Monitor
ALERT6_1_RULES=2:50,3:60                    # Format: topX:threshold,topX:threshold
ALERT6_1_TIME_WINDOW_HOURS=24               # Rolling window
ALERT6_1_INTERVAL_MINUTES=360               # Check every 6 hours
ALERT6_1_EXCLUDE_PUSHOVER=false             # Send to phone
ALERT6_1_EXCLUDE_CHANNELS=                  # Send to all Slack channels
ALERT6_1_EXCLUDE_USERS=                     # Send to all Slack users

# ============================================
# Instance 2: Trading Desk Monitor (DISABLED by default)
# ============================================
ALERT6_2_ENABLED=false
ALERT6_2_NAME=Trading Desk Monitor
ALERT6_2_RULES=5:75,10:90
ALERT6_2_TIME_WINDOW_HOURS=24
ALERT6_2_INTERVAL_MINUTES=360
ALERT6_2_EXCLUDE_PUSHOVER=true              # No phone alerts
ALERT6_2_EXCLUDE_CHANNELS=                  # Only certain channels
ALERT6_2_EXCLUDE_USERS=

# ============================================
# Instance 3: Executive Alert (DISABLED by default)
# ============================================
ALERT6_3_ENABLED=false
ALERT6_3_NAME=Executive Alert
ALERT6_3_RULES=2:50                         # Single rule for simplicity
ALERT6_3_TIME_WINDOW_HOURS=24
ALERT6_3_INTERVAL_MINUTES=360
ALERT6_3_EXCLUDE_PUSHOVER=true
ALERT6_3_EXCLUDE_CHANNELS=
ALERT6_3_EXCLUDE_USERS=

# ============================================
# Additional instances (4-10) - Add as needed
# ============================================
# ALERT6_4_ENABLED=false
# ALERT6_4_NAME=Custom Monitor 4
# ALERT6_4_RULES=3:60,5:75
# ALERT6_4_TIME_WINDOW_HOURS=24
# ALERT6_4_INTERVAL_MINUTES=360
# ALERT6_4_EXCLUDE_PUSHOVER=false
# ALERT6_4_EXCLUDE_CHANNELS=
# ALERT6_4_EXCLUDE_USERS=

# ============================================
# ALERT 7: FAAM Status Reports
# ============================================
# Scheduled concentration reports (regardless of thresholds)
# Shows "what's happening" vs Alert 6 "what's wrong"
#
# Use Cases:
#   - Hourly concentration snapshots
#   - Daily summary reports
#   - Analyst/research team updates

# Enable/disable
ALERT7_ENABLED=true

# Scheduling
ALERT7_INTERVAL_MINUTES=60              # Report every hour (adjust as needed)

# Time window for report
ALERT7_TIME_WINDOW_HOURS=1              # Show last 1 hour (or 24 for daily summary)

# What to show
ALERT7_SHOW_TOP_X=5,10,20               # Show concentration for top 5, 10, and 20 providers
ALERT7_BREAKDOWN_COUNT=5                # Show detailed breakdown for top N providers

# Reuses Alert 6 API configuration (ALERT6_FAAMVIEW_API_KEY and ALERT6_FAAMVIEW_API_URL)

# Alert 7 exclusions
ALERT7_EXCLUDE_PUSHOVER=true            # Usually don't want phone notifications for reports
ALERT7_EXCLUDE_CHANNELS=
ALERT7_EXCLUDE_USERS=
